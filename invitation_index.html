<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AIONOS – Avatar Generator</title>

<style>
:root {
  --bg:#0f1115; --panel:#161a26; --accent:#5b7cfa;
  --text:#fff; --muted:#9aa0b4;
}
body { margin:0; background:var(--bg); color:var(--text); font-family:Arial; }
.page { padding:32px; }
.main { display:grid; grid-template-columns:420px 1fr; gap:28px; }

.left {
  background:var(--panel);
  border-radius:20px;
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.section {
  border-top:1px solid #2a2f45;
  padding-top:12px;
}

.hidden { display:none !important; }

.upload-box {
  border:2px dashed #2a2f45;
  border-radius:16px;
  padding:16px;
  text-align:center;
  cursor:pointer;
}
.upload-box input { display:none; }

.gender-box {
  display:flex;
  gap:20px;
}

.avatars {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
.avatar {
  border:2px solid transparent;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
}
.avatar img {
  width:100%;
  height:110px;
  object-fit:cover;
}
.avatar.selected {
  border-color:var(--accent);
}

.video-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.video-box {
  border:2px solid transparent;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
}
.video-box video {
  width:100%;
  height:110px;
  object-fit:cover;
}
.video-box.selected {
  border-color:var(--accent);
}

.generate-btn {
  height:54px;
  border-radius:16px;
  border:none;
  background:linear-gradient(135deg,#4f7cff,#6b8cff);
  color:white;
  font-size:16px;
}

.right {
  background:black;
  border-radius:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}
.placeholder { color:var(--muted); }
video#output {
  width:100%;
  height:100%;
  display:none;
}
</style>
</head>

<body>
<div class="page">
<div class="main">

<form class="left" id="form">

<b>Source</b>
<label><input type="radio" name="source" value="upload" required> Upload from computer</label>
<label><input type="radio" name="source" value="default"> Default selection</label>

<!-- UPLOAD MODE -->
<div id="uploadSection" class="section hidden">
  <label class="upload-box">
    Upload Video
    <input type="file" name="video" id="uploadVideo" accept="video/mp4">
  </label>

  <div class="gender-box">
    <label><input type="radio" name="gender" value="male" required> Male</label>
    <label><input type="radio" name="gender" value="female"> Female</label>
  </div>
</div>

<!-- DEFAULT MODE -->
<div id="defaultSection" class="section hidden">

  <label><input type="radio" name="defaultType" value="image" required> Select from image</label>
  <label><input type="radio" name="defaultType" value="video"> Select from video</label>

  <!-- IMAGE AVATARS -->
  <div id="imageSection" class="avatars hidden">
    <div class="avatar" data-avatar="bengal.png" data-gender="female">
      <img src="/inputs/bengal.png">
    </div>
    <div class="avatar" data-avatar="rajasthani.png" data-gender="female">
      <img src="/inputs/rajasthani.png">
    </div>
    <div class="avatar" data-avatar="punjabi.png" data-gender="male">
      <img src="/inputs/punjabi.png">
    </div>
  </div>

  <!-- VIDEO AVATARS -->
  <div id="videoSection" class="video-grid hidden">
    <div class="video-box" data-avatar="male.mp4" data-gender="male">
      <video src="/inputs/male.mp4" autoplay muted loop></video>
    </div>
    <div class="video-box" data-avatar="female.mp4" data-gender="female">
      <video src="/inputs/female.mp4" autoplay muted loop></video>
    </div>
  </div>

</div>

<input type="hidden" name="avatar" id="avatarField">

<input type="text" name="text" placeholder="Enter text…" required>

<button class="generate-btn">Generate</button>

</form>

<div class="right">
  <div class="placeholder" id="placeholder">Output video here</div>
  <video id="output" controls></video>
</div>

</div>
</div>

<script>
const uploadSection = document.getElementById("uploadSection");
const defaultSection = document.getElementById("defaultSection");
const imageSection = document.getElementById("imageSection");
const videoSection = document.getElementById("videoSection");
const avatarField = document.getElementById("avatarField");
const output = document.getElementById("output");
const placeholder = document.getElementById("placeholder");

/* SOURCE SWITCH */
document.querySelectorAll("input[name='source']").forEach(r => {
  r.onchange = () => {
    uploadSection.classList.toggle("hidden", r.value !== "upload");
    defaultSection.classList.toggle("hidden", r.value !== "default");

    imageSection.classList.add("hidden");
    videoSection.classList.add("hidden");
    avatarField.value = "";
  };
});

/* IMAGE vs VIDEO SWITCH (FIXED) */
document.querySelectorAll("input[name='defaultType']").forEach(r => {
  r.onchange = () => {
    imageSection.classList.add("hidden");
    videoSection.classList.add("hidden");

    document.querySelectorAll(".avatar, .video-box")
      .forEach(x => x.classList.remove("selected"));

    avatarField.value = "";

    if (r.value === "image") imageSection.classList.remove("hidden");
    if (r.value === "video") videoSection.classList.remove("hidden");
  };
});

/* AVATAR / VIDEO SELECT */
document.querySelectorAll(".avatar, .video-box").forEach(el => {
  el.onclick = () => {
    document.querySelectorAll(".avatar, .video-box")
      .forEach(x => x.classList.remove("selected"));

    el.classList.add("selected");
    avatarField.value = el.dataset.avatar;

    const g = el.dataset.gender;
    document.querySelector(`input[name="gender"][value="${g}"]`).checked = true;
  };
});

/* SUBMIT */
document.getElementById("form").onsubmit = async e => {
  e.preventDefault();

  placeholder.style.display = "none";

  await fetch("/generate", {
    method: "POST",
    body: new FormData(e.target)
  });

  output.src = "/video?t=" + Date.now();
  output.style.display = "block";
  output.play();
};
</script>

</body>
</html>
