<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AIONOS â€“ Avatar Generator</title>

  <style>
    body { background:#0f1115; color:white; font-family:Arial; margin:0 }
    .page { padding:32px }
    .main { display:grid; grid-template-columns:420px 1fr; gap:28px }
    .left { background:#161a26; border-radius:20px; padding:24px; display:flex; flex-direction:column; gap:16px }
    .section { border-top:1px solid #2a2f45; padding-top:16px }
    .hidden { display:none !important }
    .upload-box { border:2px dashed #2a2f45; border-radius:16px; padding:16px; text-align:center; cursor:pointer }
    .upload-box input { display:none }
    .gender-box { display:flex; gap:20px }
    .avatars, .video-grid { display:grid; gap:12px }
    .avatars { grid-template-columns:repeat(3,1fr) }
    .video-grid { grid-template-columns:1fr 1fr }
    .avatar, .video-box { border:2px solid transparent; border-radius:14px; cursor:pointer }
    .avatar.selected, .video-box.selected { border-color:#5b7cfa }
    img, video { width:100%; height:110px; object-fit:cover }
    textarea { min-height:140px; padding:14px; border-radius:14px }
    button { height:54px; border-radius:16px; border:none; background:#5b7cfa; color:white; font-size:16px }
    .right { background:black; border-radius:24px; display:flex; align-items:center; justify-content:center }
    video#output { width:100%; height:100%; display:none }
  </style>
</head>

<body>
<div class="page">
<div class="main">

<form class="left" id="form">

<b>Source</b>
<label><input type="radio" name="source" value="upload" required> Upload from computer</label>
<label><input type="radio" name="source" value="default"> Default selection</label>

<div id="uploadSection" class="section hidden">
  <label class="upload-box">
    Upload Video
    <input type="file" name="video" accept="video/mp4">
  </label>

  <div class="gender-box">
    <label><input type="radio" name="gender" value="male"> Male</label>
    <label><input type="radio" name="gender" value="female"> Female</label>
  </div>
</div>

<div id="defaultSection" class="section hidden">
  <label><input type="radio" name="defaultType" value="image"> Select from image</label>
  <label><input type="radio" name="defaultType" value="video"> Select from video</label>

  <div id="imageSection" class="avatars hidden">
    <div class="avatar" data-avatar="bengal.png" data-gender="female"><img src="/inputs/bengal.png"></div>
    <div class="avatar" data-avatar="rajasthani.png" data-gender="female"><img src="/inputs/rajasthani.png"></div>
    <div class="avatar" data-avatar="punjabi.png" data-gender="male"><img src="/inputs/punjabi.png"></div>
  </div>

  <div id="videoSection" class="video-grid hidden">
    <div class="video-box" data-avatar="male.mp4" data-gender="male"><video src="/inputs/male.mp4" autoplay muted loop></video></div>
    <div class="video-box" data-avatar="female.mp4" data-gender="female"><video src="/inputs/female.mp4" autoplay muted loop></video></div>
  </div>
</div>

<input type="hidden" name="avatar" id="avatarField">
<textarea name="text" required placeholder="Enter script..."></textarea>
<button>Generate</button>

</form>

<div class="right">
  <video id="output" controls></video>
</div>

</div>
</div>

<script>
const uploadSection = document.getElementById("uploadSection");
const defaultSection = document.getElementById("defaultSection");
const imageSection = document.getElementById("imageSection");
const videoSection = document.getElementById("videoSection");
const avatarField = document.getElementById("avatarField");
const output = document.getElementById("output");

const uploadVideoInput = document.querySelector("input[name='video']");
const defaultRadios = document.querySelectorAll("input[name='defaultType']");
const genderRadios = document.querySelectorAll("input[name='gender']");

/* SOURCE SWITCH â€” FIXED */
document.querySelectorAll("input[name='source']").forEach(r => {
  r.onchange = () => {
    const isUpload = r.value === "upload";

    uploadSection.classList.toggle("hidden", !isUpload);
    defaultSection.classList.toggle("hidden", isUpload);

    // ðŸ”¥ CRITICAL FIX
    uploadVideoInput.disabled = !isUpload;

    // Required handling
    defaultRadios.forEach(x => x.required = !isUpload);
    genderRadios.forEach(x => x.required = isUpload);

    // Reset state
    avatarField.value = "";
    uploadVideoInput.value = "";
    imageSection.classList.add("hidden");
    videoSection.classList.add("hidden");
  };
});

/* IMAGE vs VIDEO SWITCH */
document.querySelectorAll("input[name='defaultType']").forEach(r => {
  r.onchange = () => {
    imageSection.classList.add("hidden");
    videoSection.classList.add("hidden");
    avatarField.value = "";

    if (r.value === "image") imageSection.classList.remove("hidden");
    if (r.value === "video") videoSection.classList.remove("hidden");
  };
});

/* AVATAR / VIDEO SELECT */
document.querySelectorAll(".avatar,.video-box").forEach(el => {
  el.onclick = () => {
    document.querySelectorAll(".avatar,.video-box")
      .forEach(x => x.classList.remove("selected"));

    el.classList.add("selected");
    avatarField.value = el.dataset.avatar;

    document.querySelector(
      `input[name="gender"][value="${el.dataset.gender}"]`
    ).checked = true;
  };
});

/* SUBMIT */
document.getElementById("form").onsubmit = async e => {
  if (!e.target.checkValidity()) {
    e.target.reportValidity();
    return;
  }

  e.preventDefault();

  await fetch("/generate", {
    method: "POST",
    body: new FormData(e.target)
  });

  output.src = "/video?t=" + Date.now();
  output.style.display = "block";
  output.play();
};
</script>

</body>
</html>
